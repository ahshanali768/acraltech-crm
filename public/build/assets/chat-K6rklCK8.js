import{a as u}from"./index-xsH4HHeE.js";let c="public",i=null;function g(e){const t=document.getElementById("chat-content");t&&(t.innerHTML="",e.forEach(a=>{const n=a.sender_id===window.Laravel.userId,s=document.createElement("div");s.className="mb-2 flex "+(n?"justify-end":"justify-start"),s.innerHTML=`<div class="max-w-[70%] px-3 py-2 rounded-xl ${n?"bg-[#edeaff] text-[#6c63ff]":"bg-gray-100 text-gray-800"} shadow-sm">
            <span class="font-semibold">${a.sender?.name||""}</span><br>${a.message}
        </div>`,t.appendChild(s)}),t.scrollTop=t.scrollHeight)}function r(){!window.Laravel||!window.Laravel.userId||u.get("/chat/public").then(e=>g(e.data)).catch(e=>{e.response&&e.response.status===401?console.warn("Chat: User not authenticated for public messages"):console.error("Chat: Error fetching public messages:",e)})}function m(e){!window.Laravel||!window.Laravel.userId||u.get("/chat/private/"+e).then(t=>g(t.data)).catch(t=>{t.response&&t.response.status===401?console.warn("Chat: User not authenticated for private messages"):console.error("Chat: Error fetching private messages:",t)})}function p(){!window.Laravel||!window.Laravel.userId||u.get("/chat/users").then(e=>{const t=e.data,a=document.getElementById("chat-users");a&&(a.innerHTML="",t.forEach(n=>{const s=document.createElement("button");s.className="block w-full text-left px-2 py-1 rounded hover:bg-[#edeaff]",s.innerText=n.name,s.onclick=()=>{i=n.id,c="private";const o=document.getElementById("chat-tab-private"),d=document.getElementById("chat-tab-public"),f=document.getElementById("chat-users");o&&o.classList.add("bg-[#edeaff]","text-[#6c63ff]"),d&&d.classList.remove("bg-[#edeaff]","text-[#6c63ff]"),f&&f.classList.add("hidden"),m(n.id)},a.appendChild(s)}))}).catch(e=>{e.response&&e.response.status===401?console.warn("Chat: User not authenticated for users list"):console.error("Chat: Error fetching users:",e)})}function l(){const e=window.Laravel.isGuest===!0||window.Laravel.isGuest==="true",t=document.getElementById("chat-tab-private"),a=document.getElementById("chat-form"),n=document.getElementById("chat-guest-warning");t&&(t.disabled=e,t.classList.toggle("opacity-50",e)),a&&(a.style.display=e&&c==="private"?"none":""),n&&n.classList.toggle("hidden",!(e&&c==="private"))}document.addEventListener("DOMContentLoaded",function(){if(!window.Laravel||!window.Laravel.userId)return;const e=document.getElementById("chat-tab-public"),t=document.getElementById("chat-tab-private"),a=document.getElementById("chat-users"),n=document.getElementById("chat-content"),s=document.getElementById("chat-form"),o=document.getElementById("chat-input");e&&(e.onclick=function(){c="public",l(),e.classList.add("bg-[#edeaff]","text-[#6c63ff]"),t&&t.classList.remove("bg-[#edeaff]","text-[#6c63ff]"),a&&a.classList.add("hidden"),r()}),t&&(t.onclick=function(){c="private",l(),t.classList.add("bg-[#edeaff]","text-[#6c63ff]"),e&&e.classList.remove("bg-[#edeaff]","text-[#6c63ff]"),a&&a.classList.remove("hidden"),p(),n&&(n.innerHTML='<div class="text-gray-400 text-center mt-8">Select a user to chat privately</div>')}),l(),window.Laravel.userId&&r(),s&&(s.onsubmit=function(d){if((window.Laravel.isGuest===!0||window.Laravel.isGuest==="true")&&c==="private")return d.preventDefault(),l(),!1;if(d.preventDefault(),!o)return;const h=o.value.trim();h&&u.post("/chat/send",{message:h,receiver_id:c==="private"&&i?i:null}).then(()=>{o.value="",c==="public"?r():i&&m(i)})}),window.Echo&&(window.Echo.channel("chat.public").listen("MessageSent",d=>{c==="public"&&document.getElementById("chat-modal")&&!document.getElementById("chat-modal").classList.contains("hidden")&&r()}),window.Echo.private("chat.private."+Math.min(window.Laravel.userId,i||0)+"."+Math.max(window.Laravel.userId,i||0)).listen("MessageSent",d=>{c==="private"&&i&&document.getElementById("chat-modal")&&!document.getElementById("chat-modal").classList.contains("hidden")&&m(i)}))});window.toggleChatModal=function(){const e=document.getElementById("chat-modal");if(e&&(e.classList.toggle("hidden"),!e.classList.contains("hidden"))){c="public",typeof l=="function"&&l(),window.Laravel&&window.Laravel.userId&&typeof r=="function"&&r();const t=document.getElementById("chat-tab-public"),a=document.getElementById("chat-tab-private"),n=document.getElementById("chat-users");t&&t.classList.add("bg-[#edeaff]","text-[#6c63ff]"),a&&a.classList.remove("bg-[#edeaff]","text-[#6c63ff]"),n&&n.classList.add("hidden")}};
